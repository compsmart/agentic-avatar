<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Avatar Assistant</title>
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Import maps for TalkingHead -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js/+esm",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/",
            "talkinghead": "./modules/talkinghead.mjs"
        }
    }
    </script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header>
            <h1>AI Avatar Assistant</h1>
            <p class="subtitle">Talk with your intelligent digital companion</p>
        </header>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Avatar Container -->
            <div id="avatar-section">
                <div id="avatar-container"></div>
                <div id="avatar-status" class="status-indicator">
                    <span class="status-dot"></span>
                    <span id="status-text">Loading avatar...</span>
                </div>
            </div>

            <!-- Chat Interface -->
            <div id="chat-section">
                <!-- Transcript Display -->
                <div id="transcript-container">
                    <h3>Conversation</h3>
                    <div id="transcript" class="transcript-box"></div>
                </div>

                <!-- Current Response -->
                <div id="response-container">
                    <div id="response" class="response-box"></div>
                </div>

                <!-- Subtitles for current speech -->
                <div id="subtitles" class="subtitles"></div>
            </div>
        </div>

        <!-- Controls -->
        <div id="controls">
            <div class="control-group">
                <button id="start-conversation" class="btn btn-primary">
                    <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                    Start Talking
                </button>
                <button id="stop-conversation" class="btn btn-secondary" disabled>
                    <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="6" y="6" width="12" height="12"></rect>
                    </svg>
                    Stop
                </button>
                <button id="clear-conversation" class="btn btn-tertiary">
                    <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Clear
                </button>
            </div>

            <!-- Text Input Section -->
            <div class="text-input-group">
                <input 
                    type="text" 
                    id="text-input" 
                    class="text-input" 
                    placeholder="Type your message here..."
                    autocomplete="off"
                />
                <button id="send-text-btn" class="btn btn-primary">
                    <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                    Send
                </button>
            </div>

            <!-- Voice Settings -->
            <div class="settings-group">
                <label for="voice-select">Voice:</label>
                <select id="voice-select" class="select">
                    <option value="alloy">Alloy</option>
                    <option value="echo">Echo</option>
                    <option value="fable">Fable</option>
                    <option value="onyx">Onyx</option>
                    <option value="nova">Nova</option>
                    <option value="shimmer">Shimmer</option>
                </select>

                <label for="avatar-mood">Mood:</label>
                <select id="avatar-mood" class="select">
                    <option value="neutral">Neutral</option>
                    <option value="happy">Happy</option>
                    <option value="sad">Sad</option>
                    <option value="angry">Angry</option>
                    <option value="love">Love</option>
                </select>

                <label for="camera-view">View:</label>
                <select id="camera-view" class="select">
                    <option value="full" selected>Full Body</option>
                    <option value="mid">Mid Body</option>
                    <option value="upper">Upper Body</option>
                    <option value="head">Head Only</option>
                </select>
            </div>

            <!-- Animation Testing -->
            <div class="animation-test-section">
                <h4>ğŸ¬ Animation Testing</h4>
                <div class="animation-controls">
                    <select id="animation-select" class="select">
                        <option value="">Select Animation...</option>
                        <option value="waving">ğŸ‘‹ Waving (3s)</option>
                        <option value="breakdance">ğŸ•º Breakdance (8s)</option>
                        <option value="defeated">ğŸ˜” Defeated (5s)</option>
                        <option value="joyful">ğŸ‰ Joyful Jump (4s)</option>
                        <option value="praying">ğŸ™ Praying (5s)</option>
                    </select>
                    <input 
                        type="number" 
                        id="animation-duration" 
                        class="input-small" 
                        placeholder="Duration (s)" 
                        min="1" 
                        max="20" 
                        step="1"
                    />
                    <button id="play-animation-btn" class="btn btn-secondary">â–¶ï¸ Play</button>
                    <button id="stop-animation-btn" class="btn btn-tertiary">â¹ï¸ Stop</button>
                </div>
                <div id="animation-status" class="animation-status"></div>
            </div>

            <!-- Gesture Testing -->
            <div class="gesture-test-section">
                <h4>ğŸ‘‹ Gesture Testing</h4>
                <div class="gesture-grid">
                    <button class="btn-gesture" data-gesture="handup">âœ‹ Hand Up</button>
                    <button class="btn-gesture" data-gesture="index">â˜ï¸ Index</button>
                    <button class="btn-gesture" data-gesture="ok">ğŸ‘Œ OK</button>
                    <button class="btn-gesture" data-gesture="thumbup">ğŸ‘ Thumbs Up</button>
                    <button class="btn-gesture" data-gesture="thumbdown">ğŸ‘ Thumbs Down</button>
                    <button class="btn-gesture" data-gesture="side">ğŸ‘ˆ Side</button>
                    <button class="btn-gesture" data-gesture="shrug">ğŸ¤· Shrug</button>
                    <button class="btn-gesture" data-gesture="namaste">ğŸ™ Namaste</button>
                </div>
            </div>

            <!-- Audio Level Indicator -->
            <div id="audio-level-container">
                <label>Audio Level:</label>
                <div id="audio-level-bar">
                    <div id="audio-level-fill"></div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="overlay hidden">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>

        <!-- Error Display -->
        <div id="error-container" class="error-container hidden">
            <div class="error-content">
                <span class="error-icon">âš ï¸</span>
                <p id="error-message"></p>
                <button id="close-error" class="btn-close">Ã—</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>Powered by OpenAI & TalkingHead | 
        <span id="connection-status" class="connection-status">
            <span class="dot"></span> Disconnected
        </span>
        </p>
    </footer>

    <script type="module" src="js/animation-library.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
