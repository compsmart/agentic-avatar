<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Debug Viewer</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
    }
    
    .container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .description {
      color: #666;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    
    .audio-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .audio-item {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      transition: all 0.3s ease;
    }
    
    .audio-item:hover {
      background: #f0f0f0;
      border-color: #667eea;
      transform: translateX(5px);
    }
    
    .audio-item h3 {
      margin: 0 0 10px 0;
      color: #333;
      font-size: 16px;
    }
    
    .audio-info {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }
    
    audio {
      width: 100%;
      margin-top: 10px;
    }
    
    .no-files {
      text-align: center;
      padding: 40px;
      color: #999;
      font-size: 18px;
    }
    
    .refresh-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 20px;
      transition: background 0.3s ease;
    }
    
    .refresh-btn:hover {
      background: #5568d3;
    }
    
    .error {
      background: #fee;
      border: 1px solid #fcc;
      color: #c33;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
    }
    
    .transcript {
      background: #e3f2fd;
      padding: 8px 12px;
      border-radius: 4px;
      margin-top: 8px;
      font-style: italic;
      color: #1565c0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéµ Audio Debug Viewer</h1>
    <p class="description">
      This page shows the audio files recorded during voice chat sessions. 
      Use this to verify that your microphone is working and audio is being captured correctly.
      The system keeps the last 10 recordings.
    </p>
    
    <button class="refresh-btn" onclick="loadAudioFiles()">üîÑ Refresh List</button>
    
    <div id="content" class="loading">Loading audio files...</div>
  </div>

  <script>
    async function loadAudioFiles() {
      const content = document.getElementById('content');
      content.innerHTML = '<div class="loading">Loading audio files...</div>';
      
      try {
        const response = await fetch('/api/debug-audio-list');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        if (!data.files || data.files.length === 0) {
          content.innerHTML = '<div class="no-files">No audio files found yet. Record some voice messages first!</div>';
          return;
        }
        
        let html = '<div class="audio-list">';
        
        data.files.forEach((file, index) => {
          const transcript = file.name.split('-transcript-')[1]?.split('.webm')[0]?.split('.mp4')[0]?.split('.mp3')[0]?.replace(/_/g, ' ') || 'Unknown';
          
          html += `
            <div class="audio-item">
              <h3>üé§ Recording #${data.files.length - index}</h3>
              <div class="audio-info">
                üìÖ ${new Date(file.time).toLocaleString()}<br>
                üìÅ ${file.name}<br>
                üìä ${(file.size / 1024).toFixed(2)} KB
              </div>
              ${transcript !== 'Unknown' ? `<div class="transcript">üí¨ "${transcript}"</div>` : ''}
              <audio controls preload="metadata">
                <source src="/uploads/debug-audio/${file.name}" type="audio/webm">
                <source src="/uploads/debug-audio/${file.name}" type="audio/mp4">
                Your browser does not support the audio element.
              </audio>
            </div>
          `;
        });
        
        html += '</div>';
        content.innerHTML = html;
        
      } catch (error) {
        content.innerHTML = `
          <div class="error">
            <strong>Error loading audio files:</strong><br>
            ${error.message}
            <br><br>
            Make sure the server is running and try refreshing.
          </div>
        `;
      }
    }
    
    // Load files on page load
    loadAudioFiles();
  </script>
</body>
</html>
